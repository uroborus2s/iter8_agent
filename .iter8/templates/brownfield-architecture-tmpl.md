# {{项目名称}} 棕地增强架构

[[LLM: 除非另有说明，默认路径和文件名为 docs/architecture.md]]

[[LLM: 重要 - 需要范围和评估：

此架构文档用于需要全面架构规划的现有项目的重大增强。在继续之前：

1. **验证复杂性**: 确认此增强需要架构规划。对于简单的添加，建议："对于不需要架构规划的简单更改，考虑使用 brownfield-create-epic 或 brownfield-create-story 任务与产品负责人合作。"

2. **必需输入**:

   - 已完成的 brownfield-prd.md
   - 现有项目技术文档（来自docs文件夹或用户提供）
   - 现有项目结构的访问权限（IDE或上传的文件）

3. **深度分析要求**: 您必须在提出任何架构建议之前对现有代码库、架构模式和技术约束进行彻底分析。每个建议都必须基于实际项目分析，而不是假设。

4. **持续验证**: 在整个过程中，明确验证您对用户的理解。对于每个架构决策，确认："基于我对您现有系统的分析，我建议[决策]，因为[来自实际项目的证据]。这是否与您系统的实际情况一致？"

如果缺少任何必需的输入，请在继续之前请求它们。]]

## 简介

[[LLM: 本节为棕地增强建立文档的目的和范围。保留以下内容，但确保项目名称和增强详细信息被正确替换。

呈现本节后，应用 `tasks#advanced-elicitation` 协议]]

本文档概述了通过{{增强描述}}来增强{{项目名称}}的架构方法。其主要目标是作为AI驱动的新功能开发的指导性架构蓝图，同时确保与现有系统的无缝集成。

**与现有架构的关系:**
本文档通过定义新组件如何与当前系统集成来补充现有项目架构。当新模式与现有模式之间出现冲突时，本文档提供在实施增强时保持一致性的指导。

### 现有项目分析

[[LLM: 分析现有项目结构和架构：

1. 审查docs文件夹中的现有文档
2. 检查当前技术栈和版本
3. 识别现有架构模式和约定
4. 注意当前部署和基础设施设置
5. 记录任何约束或限制

关键：在您的分析之后，明确验证您的发现："基于我对您项目的分析，我已经识别出您现有系统的以下内容：[关键发现]。在我继续架构建议之前，请确认这些观察是准确的。"

呈现发现并应用 `tasks#advanced-elicitation` 协议]]

**当前项目状态:**

- **主要目的:** {{现有项目目的}}
- **当前技术栈:** {{现有技术摘要}}
- **架构风格:** {{现有架构风格}}
- **部署方法:** {{现有部署方法}}

**可用文档:**

- {{现有文档摘要}}

**识别的约束:**

- {{约束1}}
- {{约束2}}
- {{约束3}}

### 变更日志

| 变更 | 日期 | 版本 | 描述 | 作者 |
| ------ | ---- | ------- | ----------- | ------ |

## 增强范围和集成策略

[[LLM: 定义增强如何与现有系统集成：

1. 审查棕地PRD增强范围
2. 识别与现有代码的集成点
3. 定义新功能和现有功能之间的边界
4. 建立兼容性要求

验证检查点：在呈现集成策略之前，确认："基于我的分析，我提出的集成方法考虑了[特定的现有系统特征]。这些集成点和边界尊重您当前的架构模式。这个评估准确吗？"

呈现完整的集成策略并应用 `tasks#advanced-elicitation` 协议]]

### 增强概述

**增强类型:** {{增强类型}}
**范围:** {{增强范围}}
**集成影响:** {{集成影响级别}}

### 集成方法

**代码集成策略:** {{代码集成方法}}
**数据库集成:** {{数据库集成方法}}
**API集成:** {{API集成方法}}
**UI集成:** {{UI集成方法}}

### 兼容性要求

- **现有API兼容性:** {{API兼容性}}
- **数据库模式兼容性:** {{数据库兼容性}}
- **UI/UX一致性:** {{UI兼容性}}
- **性能影响:** {{性能约束}}

## 技术栈对齐

[[LLM: 确保新组件与现有技术选择对齐：

1. 使用现有技术栈作为基础
2. 只有在绝对必要时才引入新技术
3. 用清晰的理由证明任何新添加
4. 确保与现有依赖的版本兼容性

呈现完整的技术栈对齐并应用 `tasks#advanced-elicitation` 协议]]

### 现有技术栈

[[LLM: 记录必须维护或集成的当前栈]]

| 类别           | 当前技术 | 版本     | 在增强中的使用 | 注释     |
| :----------------- | :----------------- | :---------- | :------------------- | :-------- |
| **语言**       | {{语言}}       | {{版本}} | {{使用}}            | {{注释}} |
| **运行时**        | {{运行时}}        | {{版本}} | {{使用}}            | {{注释}} |
| **框架**      | {{框架}}      | {{版本}} | {{使用}}            | {{注释}} |
| **数据库**       | {{数据库}}       | {{版本}} | {{使用}}            | {{注释}} |
| **API风格**      | {{API风格}}      | {{版本}} | {{使用}}            | {{注释}} |
| **身份验证** | {{认证}}           | {{版本}} | {{使用}}            | {{注释}} |
| **测试**        | {{测试框架}} | {{版本}} | {{使用}}            | {{注释}} |
| **构建工具**     | {{构建工具}}     | {{版本}} | {{使用}}            | {{注释}} |

### 新技术添加

[[LLM: 仅在增强需要新技术时包含]]

^^CONDITION: has_new_tech^^

| 技术   | 版本     | 目的     | 理由     | 集成方法 |
| :----------- | :---------- | :---------- | :------------ | :----------------- |
| {{新技术}} | {{版本}} | {{目的}} | {{理由}} | {{集成}}    |

^^/CONDITION: has_new_tech^^

## 数据模型和模式变更

[[LLM: 定义新数据模型以及它们如何与现有模式集成：

1. 识别增强所需的新实体
2. 定义与现有数据模型的关系
3. 规划数据库模式变更（添加、修改）
4. 确保向后兼容性

呈现数据模型变更并应用 `tasks#advanced-elicitation` 协议]]

### 新数据模型

<<REPEAT: 新数据模型>>

### {{模型名称}}

**目的:** {{模型目的}}
**集成:** {{与现有的集成}}

**关键属性:**

- {{属性1}}: {{类型1}} - {{描述1}}
- {{属性2}}: {{类型2}} - {{描述2}}

**关系:**

- **与现有:** {{现有关系}}
- **与新的:** {{新关系}}

<</REPEAT>>

### 模式集成策略

**需要的数据库变更:**

- **新表:** {{新表列表}}
- **修改的表:** {{修改表列表}}
- **新索引:** {{新索引列表}}
- **迁移策略:** {{迁移方法}}

**向后兼容性:**

- {{兼容性措施1}}
- {{兼容性措施2}}

## 组件架构

[[LLM: 定义新组件及其与现有架构的集成：

1. 识别增强所需的新组件
2. 定义与现有组件的接口
3. 建立清晰的边界和职责
4. 规划集成点和数据流

强制验证：在呈现组件架构之前，确认："我提出的新组件遵循我在您代码库中识别的现有架构模式：[特定模式]。集成接口尊重您当前的组件结构和通信模式。这是否与您项目的实际情况匹配？"

呈现组件架构并应用 `tasks#advanced-elicitation` 协议]]

### 新组件

<<REPEAT: 新组件>>

### {{组件名称}}

**职责:** {{组件描述}}
**集成点:** {{与现有组件的集成}}

**关键接口:**

- {{接口1}}
- {{接口2}}

**依赖:**

- **现有组件:** {{现有依赖}}
- **新组件:** {{新依赖}}

**技术栈:** {{组件技术细节}}
<</REPEAT>>

### 组件集成图

[[LLM: 创建Mermaid图表显示新组件如何与现有架构集成。选择最适合清晰度的图表类型。

呈现图表后，应用 `tasks#advanced-elicitation` 协议]]

## API变更和扩展

[[LLM: 定义对现有API的变更和新API端点：

1. 识别需要修改的现有端点
2. 定义新的API端点
3. 确保向后兼容性
4. 规划版本控制策略

呈现API变更并应用 `tasks#advanced-elicitation` 协议]]

### 现有API修改

^^CONDITION: has_api_modifications^^

<<REPEAT: API修改>>

#### {{端点名称}}

**当前实现:** {{当前实现}}
**建议变更:** {{建议变更}}
**兼容性影响:** {{兼容性影响}}
**迁移策略:** {{迁移策略}}

<</REPEAT>>

^^/CONDITION: has_api_modifications^^

### 新API端点

^^CONDITION: has_new_apis^^

<<REPEAT: 新API>>

#### {{新端点名称}}

**目的:** {{端点目的}}
**方法:** {{HTTP方法}}
**路径:** {{端点路径}}
**集成:** {{与现有API的集成}}

<</REPEAT>>

^^/CONDITION: has_new_apis^^

## 工作流集成

[[LLM: 使用序列图说明新功能如何与现有工作流集成：

1. 识别受影响的现有工作流
2. 显示新组件如何参与现有流程
3. 包含错误处理和回滚策略
4. 记录任何破坏性变更

呈现工作流集成图表后，应用 `tasks#advanced-elicitation` 协议]]

## 测试策略

[[LLM: 定义测试新功能和现有功能集成的策略：

1. 规划单元测试新组件
2. 规划集成测试新旧组件交互
3. 规划回归测试确保现有功能不受影响
4. 定义测试数据管理策略

呈现测试策略后，应用 `tasks#advanced-elicitation` 协议]]

### 测试方法

**新功能测试:**

- **单元测试:** {{新组件单元测试}}
- **集成测试:** {{新组件集成测试}}
- **端到端测试:** {{新功能E2E测试}}

**现有功能测试:**

- **回归测试:** {{回归测试策略}}
- **兼容性测试:** {{兼容性测试方法}}
- **性能测试:** {{性能影响测试}}

### 测试数据管理

**测试环境:** {{测试环境设置}}
**数据迁移测试:** {{数据迁移测试}}
**回滚测试:** {{回滚测试策略}}

## 部署和发布策略

[[LLM: 定义安全部署增强的策略：

1. 规划分阶段部署方法
2. 定义功能标志策略
3. 规划回滚程序
4. 建立监控和观察策略

呈现部署策略后，应用 `tasks#advanced-elicitation` 协议]]

### 部署方法

**部署策略:** {{部署策略类型}}
**发布阶段:** {{发布阶段}}
**功能标志:** {{功能标志使用}}

### 回滚策略

**回滚触发器:** {{回滚条件}}
**回滚程序:** {{回滚步骤}}
**数据回滚:** {{数据回滚策略}}

### 监控和观察

**关键指标:** {{监控指标}}
**警报设置:** {{警报配置}}
**日志策略:** {{日志增强}}

## 风险和缓解

[[LLM: 识别棕地增强的特定风险：

1. 集成复杂性风险
2. 向后兼容性风险
3. 性能影响风险
4. 数据完整性风险

呈现风险和缓解策略后，应用 `tasks#advanced-elicitation` 协议]]

### 关键风险

<<REPEAT: 风险>>

### {{风险名称}}

**描述:** {{风险描述}}
**概率:** {{高/中/低}}
**影响:** {{高/中/低}}
**缓解策略:** {{缓解方法}}
**应急计划:** {{应急措施}}

<</REPEAT>>

## 编码标准和约定

[[LLM: 定义与现有代码库一致的编码标准：

1. 遵循现有项目的编码风格
2. 维护现有命名约定
3. 遵循现有架构模式
4. 仅在必要时引入新模式

呈现编码标准后，应用 `tasks#advanced-elicitation` 协议]]

### 现有项目约定

**代码风格:** {{现有代码风格}}
**命名约定:** {{现有命名约定}}
**架构模式:** {{现有架构模式}}
**文档约定:** {{现有文档约定}}

### 增强特定标准

**新组件约定:** {{新组件标准}}
**集成模式:** {{集成模式标准}}
**错误处理:** {{错误处理约定}}

## 清单结果报告

[[LLM: 在运行清单之前，提议输出完整的棕地架构文档。一旦用户确认，执行 `architect-checklist` 并在此处填充结果。]]

---

## 下一步

[[LLM: 完成棕地架构后：

1. 推荐与现有开发团队审查
2. 验证与现有系统的集成点
3. 准备详细的实施计划
4. 建立监控和回滚程序

呈现下一步并应用 `tasks#advanced-elicitation` 协议]]

### 即时行动

1. {{即时行动1}}
2. {{即时行动2}}
3. {{即时行动3}}

### 团队协调

- **现有团队对齐:** {{团队对齐策略}}
- **知识转移:** {{知识转移计划}}
- **持续集成:** {{CI/CD更新}}

### 实施准备

- **开发环境设置:** {{开发环境}}
- **依赖管理:** {{依赖更新}}
- **文档更新:** {{文档维护}}