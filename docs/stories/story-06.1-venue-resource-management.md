# 用户故事 06.1: 场地资源管理

## 故事信息
- **故事ID**: 06.1
- **故事标题**: 场地资源管理
- **所属史诗**: 史诗06 - 运营管理
- **优先级**: 高
- **负责团队**: 运营后台团队

## 故事描述

**作为** 一名平台运营经理
**我想要** 在一个统一的后台系统中，方便地添加、编辑和管理所有的场地资源信息
**这样我可以** 确保用户端展示的场地信息是准确、完整和有吸引力的，并能根据运营策略动态调整

## 价值说明

### 核心价值
场地是平台提供服务的物理载体，是"货架"本身。一个强大、高效的场地资源管理后台（CMS - Content Management System），是整个预约平台能够顺利运营的基础设施。它直接决定了平台"商品信息"的质量和管理的灵活性。

### 业务价值
- **保障信息准确性**: 确保用户看到的场地信息（如地址、价格、设施）准确无误，是保障用户体验和避免纠纷的基础。
- **提升运营效率**: 让运营人员能快速上下架场地、修改价格、更新图片，极大地提升了日常运营工作的效率。
- **支持精细化运营**: 可以针对不同场地、不同时间段设置不同的价格和标签，支持灵活多样的营销活动。
- **增强平台扩展性**: 一个好的场地管理系统，能让平台在拓展到新城市、接入新场地时，变得简单快捷。

## 详细需求

### 功能需求
1.  **场地列表与搜索**:
    *   后台以列表形式展示所有已入驻的场地。
    *   列表项包含关键信息：场地ID、场地名称、所属城市/区域、状态（上架/下架）、创建时间。
    *   提供按场地名称、城市、状态进行搜索和筛选的功能。
2.  **新增/编辑场地**:
    *   提供一个表单，用于填写或修改场地的详细信息。
    *   **基本信息**: 场地名称、地址（支持地图点选获取经纬度）、联系电话、所属城市/区域。
    *   **详细描述**: 富文本编辑器，用于输入图文并茂的场地介绍。
    *   **图片管理**: 支持上传多张场地高清图片，并可以拖拽排序、设置封面图。
    -   **设施标签**: 提供多选框，让运营人员可以为场地打上设施标签（如"淋浴"、"停车场"、"休息区"、"灯光球场"等）。
    -   **场地类型**: 室内/室外，硬地/红土/草地等。
3.  **场地排班与定价 (核心)**:
    -   提供一个可视化的周历/日历界面，用于设置该场地的"营业时间"。
    -   可以为不同的时间段（如工作日白天、工作日晚上、周末）设置不同的基础价格。
    -   可以创建"特殊定价"，覆盖掉某个特定日期（如节假日）的常规价格。
4.  **场地状态管理**:
    *   可以随时将一个场地设置为"上架"或"下架"状态。下架后，用户端将看不到该场地。
    *   可以临时"锁定"或"开放"某个场地的某个特定时间段，用于处理包场、维修等特殊情况。
5.  **场地单元管理**:
    -   一个场地名称下可能包含多个独立的场地单元（如"XX网球中心-1号场"、"XX网球中心-2号场"）。
    -   系统需要支持这种一对多的结构，并可以对每个场地单元进行独立的排班和状态管理。

### 非功能需求
-   **可用性**: 后台操作界面应清晰直观，功能布局合理，运营人员无需复杂培训即可上手。
-   **性能**: 即使管理数千个场地，列表和编辑页的加载速度也应<3秒。
-   **安全性**: 只有获得授权的运营人员才能访问和修改场地信息，所有关键操作需要有日志记录。

## 验收标准

### 功能验收标准
-   **AC1**: 运营人员可以成功新增一个场地，并填写其所有必要信息。
-   **AC2**: 运营人员可以成功为场地设置不同时间段的差异化价格。
-   **AC3**: 运营人员可以将一个场地下架，下架后用户端立即无法搜索到该场地。
-   **AC4**: 运营人员可以成功地为一个场地下属的多个场地单元（1号场、2号场）分别设置排班。
-   **AC5**: 所有在后台的修改（如价格、图片），都能准确地同步到用户端。

### 用户体验验收标准
-   **UX1**: 后台表单的填写和编辑体验流畅，输入项有合理的校验。
-   **UX2**: 定价和排班的日历界面，交互直观，易于理解和操作。

### 业务目标验收标准
-   **BIZ1**: 新增一个场地的所有信息录入和配置工作，能在15分钟内完成。
-   **BIZ2**: 运营人员日常修改价格、更新状态的操作，能在2分钟内完成。

## 依赖关系

### 技术依赖
-   后端数据库
-   对象存储服务（用于存储场地图片）
-   地图服务API（用于地址点选）
-   前端后台UI框架

### 业务依赖
-   运营团队已制定场地接入的标准流程（SOP）。
-   已确定场地信息的必填项和选填项。

### 外部依赖
-   地图服务提供商

## 风险与缓解措施

### 主要风险
1.  **信息录入错误**: 运营人员可能填错地址、价格等关键信息，导致用户投诉和平台损失。
    -   **缓解措施**:
        *   对关键输入项（如价格、电话）增加格式和范围校验。
        *   增加操作前的"预览"功能。
        *   建立双人复核（Checker-Maker）机制，敏感操作需要另一人审核后才能生效。
2.  **系统设计僵化**: 系统无法支持未来新的定价模式或场地类型。
    -   **缓解措施**:
        *   在技术设计上，将定价、排班等设计为可扩展的规则引擎模式，而不是硬编码。
        *   将"标签"、"设施"等设计为可由运营人员自行配置的字典项。

## 成功指标

### 定量指标
-   **场地信息录入平均耗时**: <15分钟
-   **信息错误率**: <0.1%
-   **系统响应时间**: <3秒

### 定性指标
-   **运营人员满意度**: 运营团队认为该后台工具"强大"、"高效"、"易用"。

## 变更日志

| 日期 | 版本 | 描述 |
| :--- | :--- | :---------- |
|      | 1.0  | 初始版本创建，定义场地资源管理功能 |

## 相关链接

- [史诗06: 运营管理](../epics/epic-06-operation-management.md)
- [故事06.2: 用户行为分析](story-06.2-user-behavior-analytics.md)
- [故事06.3: 财务数据统计](story-06.3-financial-statistics.md)
#### FR1: 场地基础信息管理
**场地档案管理**:
- 场地编号、名称、类型（室内/室外）
- 场地规格、容量、设施设备清单
- 场地图片、位置信息、建设时间
- 维护记录、使用年限、折旧情况

**场地状态管理**:
- 可用、已预约、维护中、停用等状态
- 状态变更记录和原因说明
- 紧急情况的快速状态调整
- 状态变更的自动通知机制

#### FR2: 预约安排管理
**预约时段设置**:
- 设置每个场地的开放时间
- 配置时段长度（30分钟/1小时等）
- 设置不同时段的价格策略
- 特殊时段（节假日）的差异化定价

**预约状态监控**:
- 实时查看所有场地的预约状况
- 预约密度的可视化展示
- 空闲时段的智能提醒
- 预约冲突的自动检测和处理

#### FR3: 场地利用率分析
**统计维度**:
- 按日/周/月/年的利用率统计
- 不同时段的利用率对比
- 场地类型的利用率差异
- 季节性变化趋势分析

**收益分析**:
- 每个场地的收入统计
- 成本核算和利润分析
- ROI计算和趋势预测
- 定价策略的效果评估

#### FR4: 维护保养管理
**维护计划**:
- 定期维护计划的制定和执行
- 维护任务的分配和跟踪
- 维护成本的记录和统计
- 维护效果的评估和反馈

**设备管理**:
- 场地设备清单和状态
- 设备维修记录和成本
- 设备更新和采购计划
- 设备使用寿命分析

### 非功能需求

#### NFR1: 数据准确性
- 场地状态实时更新，延迟 ≤ 30秒
- 利用率统计精确到分钟级
- 收益数据与支付系统一致性 100%

#### NFR2: 系统性能
- 场地列表加载时间 ≤ 2秒
- 大数据量统计查询响应时间 ≤ 5秒
- 支持1000+场地的并发管理

#### NFR3: 权限安全
- 严格的角色权限控制
- 敏感数据访问日志记录
- 数据修改的审计追踪

## 验收标准

### 功能验收标准

#### AC1: 场地信息管理完整
**给定**: 管理员需要添加新场地
**当**: 管理员填写场地基础信息
**那么**: 
- 所有必要信息正确保存
- 场地状态自动设为"可用"
- 用户端可以看到新场地

#### AC2: 预约状态实时更新
**给定**: 用户完成场地预约
**当**: 支付成功后
**那么**: 
- 场地状态立即更新为"已预约"
- 管理端实时反映预约变化
- 其他用户看到该时段不可预约

#### AC3: 利用率统计准确
**给定**: 一周内有多个场地被预约
**当**: 管理员查看利用率报告
**那么**: 
- 统计数据与实际预约记录一致
- 不同维度的数据可以交叉验证
- 报告生成时间在可接受范围内

#### AC4: 维护管理流程完整
**给定**: 场地需要进行维护
**当**: 管理员创建维护任务
**那么**: 
- 场地状态自动变为"维护中"
- 该时段的预约被暂停
- 维护完成后状态恢复正常

### 用户体验验收标准

#### UX1: 界面清晰直观
- 场地状态用颜色明确区分
- 重要数据突出显示
- 操作按钮位置合理

#### UX2: 操作效率高
- 常用功能快速访问
- 批量操作支持
- 快捷键和搜索功能

#### UX3: 数据展示丰富
- 多维度图表展示
- 数据导出功能
- 自定义报表生成

### 业务目标验收标准

#### BIZ1: 管理效率提升
- 场地管理操作时间减少 50%
- 数据查询响应速度提升 80%

#### BIZ2: 利用率改善
- 场地利用率提升 20%
- 空闲时段识别准确率 ≥ 95%

## 测试用例

### 关键测试场景

#### TC1: 新场地添加流程
1. 管理员登录系统
2. 添加新场地信息
3. 设置开放时间和价格
4. 保存场地信息
5. 验证用户端显示正确

#### TC2: 场地状态变更
1. 选择正常使用的场地
2. 将状态改为"维护中"
3. 验证预约被暂停
4. 完成维护恢复正常
5. 确认预约重新开放

#### TC3: 利用率报表生成
1. 选择报表时间范围
2. 选择要统计的场地
3. 生成利用率报表
4. 验证数据准确性
5. 导出报表文件

#### TC4: 批量场地操作
1. 选择多个场地
2. 批量修改开放时间
3. 验证所有场地更新
4. 确认用户端同步显示
5. 检查操作日志记录

#### TC5: 紧急状态处理
1. 模拟场地紧急故障
2. 快速设置场地不可用
3. 取消相关预约
4. 通知受影响用户
5. 记录处理过程

## 技术实现要点

### 关键技术决策

#### 场地数据模型
```sql
venues (
  id, name, code, type, capacity,
  facilities, location, images,
  hourly_rate, status, open_time, close_time,
  created_at, updated_at
)

venue_schedules (
  id, venue_id, date, time_slot,
  status, booking_id, price,
  created_at, updated_at
)

venue_maintenance (
  id, venue_id, maintenance_type,
  start_time, end_time, description,
  cost, status, created_at
)
```

#### 利用率计算
```javascript
const calculateUtilization = (venue, startDate, endDate) => {
  const totalSlots = getTotalAvailableSlots(venue, startDate, endDate);
  const bookedSlots = getBookedSlots(venue, startDate, endDate);
  
  return {
    utilizationRate: (bookedSlots / totalSlots) * 100,
    totalSlots,
    bookedSlots,
    emptySlots: totalSlots - bookedSlots
  };
};
```

#### 实时状态同步
```javascript
// 场地状态变更广播
const updateVenueStatus = async (venueId, newStatus) => {
  await Venue.update({ status: newStatus }, { where: { id: venueId } });
  
  // 广播状态变更
  io.emit('venue_status_changed', {
    venueId,
    status: newStatus,
    timestamp: new Date()
  });
  
  // 缓存更新
  await redis.set(`venue:${venueId}:status`, newStatus);
};
```

### 性能优化
- **数据分区**: 按时间分区存储历史数据
- **索引优化**: 为常用查询建立复合索引
- **缓存策略**: Redis缓存热点场地数据
- **异步处理**: 大数据量统计任务异步执行

## 依赖和风险

### 技术依赖
- 数据库的高并发处理能力
- 实时同步机制的稳定性
- 大数据分析工具的性能

### 主要风险
- **风险1**: 场地数据不一致导致重复预约 - 缓解：事务控制，数据校验
- **风险2**: 大量历史数据影响查询性能 - 缓解：数据归档，索引优化
- **风险3**: 紧急状态变更延迟影响用户体验 - 缓解：优先级队列，降级方案

### 运营风险
- 管理员操作错误导致业务损失
- 维护时间安排不当影响用户满意度
- 价格策略调整不当影响收益

## 相关链接

- [史诗06: 运营管理](../epics/epic-06-operation-management.md)
- [故事06.2: 用户行为分析](story-06.2-user-behavior-analytics.md)
- [故事06.3: 财务数据统计](story-06.3-financial-statistics.md)
- [故事02.1: 场地信息实时展示](story-02.1-venue-realtime-display.md)

## 变更日志

| 日期 | 版本 | 描述 | 作者 |
| :--- | :------ | :---------- | :----- |
| 2024-12-27 | 1.0 | 初始版本创建，定义场地资源管理功能 | 姜尚 | 