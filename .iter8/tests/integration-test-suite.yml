# iter8 集成测试套件
# 验证iter8敏捷团队AI代理系统的完整功能
# 版本: 2.0 | 创建日期: 2025-01-08

version: "2.0"
test_suite_name: "iter8-integration-tests"
description: "iter8敏捷团队AI代理系统完整集成测试"

# === 测试配置 ===
test_configuration:
  environment: "test"
  timeout: 30000  # 30秒超时
  retry_attempts: 3
  parallel_execution: false
  cleanup_after_tests: true
  
  test_data_setup:
    mock_project_path: "./test-fixtures/mock-project"
    sample_templates: "./test-fixtures/templates"
    sample_workflows: "./test-fixtures/workflows"
    sample_configs: "./test-fixtures/configs"

# === 角色系统测试 ===
role_system_tests:
  
  test_role_activation:
    description: "测试8个角色的激活机制"
    test_cases:
      - name: "姜尚_产品负责人_激活"
        triggers: ["@姜尚", "*agent po", "@iter8/po"]
        expected_response:
          role_activated: true
          role_id: "po"
          role_name: "姜尚"
          capabilities: ["product_requirement_definition", "user_story_creation"]
        
      - name: "嫦娥_UX专家_激活"
        triggers: ["@嫦娥", "*agent ux-expert", "@iter8/ux-expert"]
        expected_response:
          role_activated: true
          role_id: "ux-expert"
          role_name: "嫦娥"
          capabilities: ["ux_design", "user_research"]
          
      - name: "鲁班_技术架构师_激活"
        triggers: ["@鲁班", "*agent architect", "@iter8/architect"]
        expected_response:
          role_activated: true
          role_id: "architect"
          role_name: "鲁班"
          capabilities: ["system_architecture_design", "technology_selection"]
          
      - name: "全部角色_触发词_测试"
        test_all_roles: true
        verify_unique_triggers: true
        verify_role_permissions: true

  test_role_context_loading:
    description: "测试角色上下文自动加载"
    test_cases:
      - role: "po"
        expected_context: ["prd", "epics", "user-stories", "business-metrics"]
        
      - role: "ux-expert"
        expected_context: ["ux-spec", "user-research", "prototypes", "design-system"]
        
      - role: "architect"
        expected_context: ["architecture", "api-spec", "tech-stack", "performance"]

  test_role_collaboration:
    description: "测试角色间协作机制"
    test_cases:
      - name: "业务价值层_协作"
        from_role: "po"
        to_role: "ux-expert"
        collaboration_type: "产品需求_用户体验设计"
        expected_handoff: true
        
      - name: "技术设计层_协作"
        from_role: "architect"
        to_role: "analyst"
        collaboration_type: "系统架构_业务分析"
        expected_handoff: true
        
      - name: "跨层_协作"
        from_role: "po"
        to_role: "architect"
        collaboration_type: "业务需求_技术可行性"
        expected_handoff: true

# === 工作流系统测试 ===
workflow_system_tests:
  
  test_workflow_execution:
    description: "测试核心工作流执行"
    test_cases:
      - name: "产品文档化_工作流"
        workflow_id: "product-documentation"
        inputs:
          project_name: "测试项目"
          business_goals: "提升用户体验"
        expected_steps:
          - step: "user-research"
            role: "ux-expert"
            status: "pending"
          - step: "prd-creation"
            role: "po"
            status: "pending"
          - step: "ux-specification"
            role: "ux-expert"
            status: "pending"
            
      - name: "史诗故事分解_工作流"
        workflow_id: "epic-story-breakdown"
        inputs:
          prd_document: "mock-prd.md"
        expected_steps:
          - step: "epic-creation"
            role: "po"
          - step: "story-breakdown"
            role: "po"
            
      - name: "架构设计_工作流"
        workflow_id: "architecture-design"
        inputs:
          requirements: "mock-requirements.md"
        expected_steps:
          - step: "requirement-analysis"
            role: "analyst"
          - step: "system-architecture"
            role: "architect"
          - step: "api-design"
            role: "architect"

  test_workflow_state_management:
    description: "测试工作流状态管理"
    test_cases:
      - name: "工作流_状态_跟踪"
        workflow_id: "product-documentation"
        test_states: ["running", "waiting", "completed", "failed"]
        verify_state_transitions: true
        
      - name: "工作流_步骤_依赖"
        workflow_id: "architecture-design"
        verify_dependencies: true
        test_parallel_execution: false

# === 模板系统测试 ===
template_system_tests:
  
  test_template_generation:
    description: "测试模板生成功能"
    test_cases:
      - name: "PRD_模板_生成"
        template_type: "prd"
        variables:
          project_name: "测试项目"
          creator_name: "测试用户"
          creation_date: "auto"
        expected_output:
          file_format: "markdown"
          required_sections: ["项目概述", "功能需求", "非功能需求"]
          
      - name: "用户故事_模板_生成"
        template_type: "user-story"
        variables:
          story_title: "用户登录功能"
          user_persona: "终端用户"
        expected_output:
          file_format: "markdown"
          required_sections: ["用户故事", "验收标准", "定义完成"]
          
      - name: "架构设计_模板_生成"
        template_type: "architecture"
        variables:
          system_name: "微服务系统"
          architecture_type: "微服务"
        expected_output:
          file_format: "markdown"
          required_sections: ["系统概述", "架构设计", "技术选型"]

  test_dynamic_data_collection:
    description: "测试动态数据收集"
    test_cases:
      - name: "系统信息_自动获取"
        test_fields:
          - "current_time"
          - "creation_date"
          - "git_branch"
          - "git_user"
          - "project_path"
        verify_auto_population: true
        
      - name: "交互式_信息收集"
        test_interactive_prompts: true
        mock_user_inputs:
          creator_name: "测试创建者"
          reviewer_name: "测试审核者"
          team_size: 5

# === 集成测试 ===
integration_tests:
  
  test_cursor_ide_integration:
    description: "测试Cursor IDE集成"
    test_cases:
      - name: "cursor_rules_配置_验证"
        config_file: ".cursor-rules"
        verify_role_triggers: true
        verify_workflow_triggers: true
        verify_template_triggers: true
        
      - name: "上下文_感知_测试"
        test_scenarios:
          - file_type: ".md"
            expected_mode: "documentation"
          - file_type: ".ts"
            expected_mode: "development"
          - directory: "docs/"
            expected_mode: "documentation"
          - directory: "src/"
            expected_mode: "development"

  test_augment_code_integration:
    description: "测试Augment Code MCP服务器集成"
    test_cases:
      - name: "MCP_服务器_启动"
        server_path: ".iter8/integrations/augment-code/mcp-server"
        verify_server_startup: true
        verify_tool_registration: true
        
      - name: "MCP_工具_调用"
        test_tools:
          - tool: "activate_role"
            inputs: { trigger: "@姜尚", user_request: "创建PRD" }
            expected_success: true
          - tool: "start_workflow"
            inputs: { workflow_id: "product-documentation" }
            expected_success: true
          - tool: "generate_template"
            inputs: { template_type: "prd" }
            expected_success: true

  test_gemini_cli_integration:
    description: "测试Gemini CLI集成"
    test_cases:
      - name: "CLI_命令_执行"
        test_commands:
          - command: "iter8 role list"
            expected_output_contains: ["姜尚", "嫦娥", "鲁班"]
          - command: "iter8 role activate po"
            expected_success: true
          - command: "iter8 workflow run product-documentation"
            expected_success: true
          - command: "iter8 template generate prd"
            expected_success: true

# === 性能测试 ===
performance_tests:
  
  test_response_times:
    description: "测试系统响应时间"
    performance_targets:
      role_activation: "< 2秒"
      template_generation: "< 5秒"
      workflow_startup: "< 3秒"
      context_loading: "< 3秒"
      
    test_cases:
      - name: "角色激活_性能"
        test_iterations: 10
        measure_response_time: true
        
      - name: "模板生成_性能"
        test_iterations: 5
        measure_generation_time: true
        
      - name: "工作流执行_性能"
        test_iterations: 3
        measure_execution_time: true

  test_concurrent_usage:
    description: "测试并发使用场景"
    test_cases:
      - name: "多角色_并发激活"
        concurrent_roles: 4
        verify_no_conflicts: true
        
      - name: "多工作流_并发执行"
        concurrent_workflows: 2
        verify_isolation: true

# === 质量指标测试 ===
quality_metrics_tests:
  
  test_success_rates:
    description: "测试成功率指标"
    target_metrics:
      role_activation_success_rate: "> 95%"
      template_generation_success_rate: "> 90%"
      workflow_completion_rate: "> 85%"
      integration_success_rate: "> 90%
      
  test_error_handling:
    description: "测试错误处理机制"
    test_cases:
      - name: "无效_角色触发"
        invalid_triggers: ["@无效角色", "*agent invalid"]
        expected_error_handling: true
        
      - name: "缺失_模板文件"
        missing_templates: ["invalid-template"]
        expected_graceful_failure: true
        
      - name: "工作流_执行失败"
        invalid_workflows: ["non-existent-workflow"]
        expected_error_recovery: true

# === 用户体验测试 ===
user_experience_tests:
  
  test_ease_of_use:
    description: "测试易用性"
    test_scenarios:
      - scenario: "新用户_首次使用"
        steps: ["角色激活", "模板生成", "工作流执行"]
        measure_learning_curve: true
        
      - scenario: "高级用户_复杂操作"
        steps: ["多角色协作", "自定义工作流", "批量操作"]
        measure_efficiency: true

  test_documentation_quality:
    description: "测试文档质量"
    verify_completeness: true
    verify_accuracy: true
    verify_clarity: true
    check_examples: true

# === 测试执行配置 ===
test_execution:
  
  test_order:
    - "role_system_tests"
    - "workflow_system_tests"
    - "template_system_tests"
    - "integration_tests"
    - "performance_tests"
    - "quality_metrics_tests"
    - "user_experience_tests"
    
  reporting:
    format: ["json", "html", "junit"]
    output_directory: "./test-results"
    include_coverage: true
    include_performance_metrics: true
    
  continuous_integration:
    run_on_commit: true
    run_on_pull_request: true
    run_nightly: true
    performance_regression_detection: true
