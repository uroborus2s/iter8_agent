# 用户故事 04.1: 好友系统

## 故事信息
- **故事ID**: 04.1
- **故事标题**: 好友系统
- **所属史诗**: 史诗04 - 社交协作
- **优先级**: 中
- **负责团队**: 社交团队 + 后端开发团队

## 故事描述

**作为** 一名平台用户
**我想要** 在平台内添加和管理我的好友
**这样我可以** 方便地邀请他们一起参加课程，查看他们的运动动态，增强社交联系

## 价值说明

### 核心价值
好友系统是所有社交功能的基础设施。通过将用户的线下社交关系映射到线上，平台能从一个纯粹的工具，转变为一个有温度、有连接的社区。这为后续的分享、邀请、排名、互动等一系列社交玩法提供了可能性。

### 业务价值
- **增强用户粘性**: 社交关系是强大的用户留存抓手，用户会因为朋友在而更愿意留在平台。
- **促进功能使用**: 好友关系能极大促进分享、邀请、费用分摊等协作功能的使用率。
- **实现网络效应**: 平台上的用户越多，社交价值越大，从而吸引更多新用户加入，形成正向循环。
- **提供社交化推荐**: 可以基于好友的行为进行推荐，如"你的好友XXX也预约了这个教练"。

## 详细需求

### 功能需求
1.  **添加好友**:
    *   **通过手机号/昵称搜索**: 用户可以输入好友的手机号或平台昵称来查找并发送好友请求。
    -   **通过通讯录添加**: (可选，需用户授权) 读取用户手机通讯录，展示哪些联系人也注册了平台，并一键发送好友请求。
    -   **扫码添加**: 每个用户都有一个专属的二维码，可以线下扫码添加好友。
    -   **通过附近的人/推荐**: (可选) 基于地理位置或共同兴趣推荐可能认识的人。
2.  **好友请求处理**:
    *   用户收到好友请求后，会在消息中心看到一个红点提示。
    *   在"新的朋友"列表中，可以看到所有好友请求，包括对方的头像、昵称和验证信息。
    -   用户可以选择"同意"或"忽略"该请求。同意后，双方正式成为好友。
3.  **好友列表**:
    *   提供一个独立的"好友"页面，按字母顺序或添加时间展示所有好友。
    *   每个好友项展示头像、昵称。
    *   (可选) 可以为好友设置备注名。
4.  **好友主页/动态**:
    *   点击好友头像，可以进入其个人主页(需处理隐私设置)。
    *   可以看到好友的基础资料、运动数据(如本周运动次数)、最近的课程动态(如"完成了一节私教课")。
5.  **好友管理**:
    *   可以删除好友。删除是双向的，即双方的好友列表中都互相消失。
    -   可以屏蔽某个好友的动态。

### 非功能需求
-   **性能**: 好友列表的加载<1秒。搜索好友的响应<2秒。
-   **可扩展性**: 好友关系存储的设计应能支持未来数百万甚至千万级的用户量。
-   **隐私性**:
    *   用户可以设置自己的个人主页谁可以看(所有人、仅好友、私密)。
    *   添加好友时，可以设置是否需要验证。

## 验收标准

### 功能验收标准
-   **AC1**: 用户可以通过搜索手机号成功找到另一个用户并发送好友请求。
-   **AC2**: 收到请求的用户可以在通知中看到请求，并可以选择同意或忽略。
-   **AC3**: 同意后，双方的好友列表中会正确显示对方。
-   **AC4**: 用户可以成功删除好友，删除后对方在自己的列表中消失。
-   **AC5**: 用户可以查看好友的个人主页(在对方隐私设置允许的情况下)。

### 用户体验验收标准
-   **UX1**: 添加好友的流程简单、明确。
-   **UX2**: 好友列表清晰、易于查找。
-   **UX3**: 隐私设置的选项和说明清晰易懂。

### 业务目标验收标准
-   **BIZ1**: 超过30%的活跃用户至少有5个好友。
-   **BIZ2**: 因好友关系而产生的课程邀请或分享，占总邀请/分享量的40%以上。

## 依赖关系

### 技术依赖
-   用户账户系统
-   消息通知系统
-   数据库(需要设计高效的好友关系表)
-   (可选) 通讯录读取API、地理位置服务

### 业务依赖
-   已制定好平台的用户隐私政策。
-   已规划好后续基于好友关系的社交玩法。

### 外部依赖
-   无

## 风险与缓解措施

### 主要风险
1.  **不良社交行为**: 可能出现恶意添加好友、骚扰等行为。
    -   **缓解措施**:
        *   提供完善的"黑名单"和"举报"功能。
        *   添加好友时，可以设置需要验证，过滤掉不希望的请求。
        *   对被多次举报的用户进行封禁处理。
2.  **隐私泄露风险**: 用户担心自己的运动数据或个人资料被不希望的人看到。
    -   **缓解措施**:
        *   提供强大且易于理解的隐私设置功能，让用户完全掌控自己信息的可见范围。
        *   默认的隐私设置应偏向保守和严格。
3.  **性能瓶颈**: 随着用户和关系数量的增长，好友列表查询、好友推荐等可能变慢。
    -   **缓解措施**:
        *   在数据库设计上进行优化，如使用反向索引、缓存等。
        *   好友推荐等复杂计算，应采用离线计算+线上服务的方式。

## 成功指标

### 定量指标
-   **好友关系对数**: 达到百万级别
-   **日均好友请求数**: >1000
-   **好友列表加载时间**: 95分位 < 1秒

### 定性指标
-   **社区氛围**: 用户感觉平台社交氛围良好、健康。
-   **功能价值**: 用户认为好友功能对于邀请朋友一起运动非常有用。

## 变更日志

| 日期 | 版本 | 描述 |
| :--- | :--- | :---------- |
|      | 1.0  | 初始版本创建，定义好友系统基础功能 |

## 相关链接

- [史诗04: 社交协作](../epics/epic-04-social-collaboration.md)
- [故事04.2: 约课分享邀请](story-04.2-booking-sharing.md)
- [故事04.3: 运动社区功能](story-04.3-sports-community.md)
- [故事01.4: 个人资料管理](story-01.4-profile-management.md)

## 变更日志

| 日期 | 版本 | 描述 | 作者 |
| :--- | :------ | :---------- | :----- |
| 2024-12-27 | 1.0 | 初始版本创建，定义好友系统功能 | 姜尚 | 